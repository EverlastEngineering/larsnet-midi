services:
  larsmet-midi:
    # Use the Dockerfile located in the current directory (.) to build the image
    build: .
    container_name: larsnet-midi
    
    # Map the entire host project directory (.) to the container's working directory /app.
    # This automatically includes all source files and subdirectories like the models folder,
    # enabling live development where host changes are reflected immediately in the container.
    volumes:
      - .:/app
    
    # Expose web UI port
    ports:
      - "49152:5000"  # LarsNet Web UI
    
    # Environment variables
    environment:
      - FLASK_ENV=production
    
    # Start the web UI automatically
    command: >
      bash -c "source ~/.bash_env &&
               cd /app &&
               python webui/app.py"
    
    # If you need to enter the container interactively (good for development):
    stdin_open: true  # Keep STDIN open
    tty: true         # Allocate a pseudo-TTY
    
    # GPU support for NVIDIA GPUs (Windows/Linux with NVIDIA Container Toolkit)
    # Uncomment the section below to enable GPU acceleration
    # For setup instructions, see SETUP_WINDOWS_GPU.md
    # deploy:
    #   resources:
    #     reservations:
    #       devices:
    #         - driver: nvidia
    #           count: all
    #           capabilities: [gpu]
